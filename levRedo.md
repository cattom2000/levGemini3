# levRedo 技术综述文档

---

## 1. 系统总览 (System Overview)

### 1.1 项目背景与目标
本项目旨在提供一个基于真实金融市场数据的市场杠杆分析系统。核心目标是通过科学的算法和直观的可视化，为市场风险分析、投资决策和学术研究提供依据。系统处理从2010年至2025年的月度市场数据，分析市场杠杆、流动性、风险情绪和投资者行为之间的关系。

### 1.2 系统架构
系统由四个核心部分组成：数据层、算法层、可视化层和文档层。
- **数据层**: 包含从 FINRA、FRED 和 Yahoo Finance 获取的原始市场数据 (`market_data.csv`)。
- **算法层**: 定义了7个核心分析指标，用于从原始数据中提取深层洞察。
- **可视化层**: 为每个核心指标设计了专门的图表，以实现信息的有效传递。
- **文档层**: 提供完整的系统说明、数据字典、算法逻辑和设计规范。

---

## 2. 数据集详解 (Data Specifications)

### 2.1 数据来源
- **FINRA**: 提供保证金账户借方余额 (`finra_D`) 和贷方余额 (`finra_CC`, `finra_CM`)。
- **Yahoo Finance**: 提供CBOE波动率指数 (`vix_index`) 和标普500指数 (`sp500_index`)。
- **FRED**: 提供M2货币供应量 (`m2_money_supply`) 和联邦基金利率 (`federal_funds_rate`)。

### 2.2 数据结构
- **文件**: `market_data.csv`
- **格式**: UTF-8编码，逗号分隔，LF换行符。
- **时间跨度**: 2010年2月 - 2025年9月 (188条月度记录)。
- **关键字段**: 
  - `date`: 日期 (YYYY-MM-DD)
  - `finra_D`: 保证金债务 (千美元)
  - `vix_index`: VIX指数值
  - `sp500_index`: 标普500指数点
  - `m2_money_supply`: M2货币供应量 (百万美元)
  - `federal_funds_rate`: 联邦基金利率 (%)

### 2.3 数据预处理
- **衍生字段**: `market_cap` (市场总市值) 通过 `sp500_index` 乘以一个近似系数（400）估算得出。
- **数据清洗**: 数据集完整，无缺失值。所有数据均经过验证和清洗。

---

## 3. 算法逻辑 (Algorithm Mechanics)

### 3.1 核心指标算法
系统定义了7个核心分析指标，其算法逻辑如下：

| 指标名称 (英文)           | 计算公式                               | 核心逻辑                                       |
|---------------------------|----------------------------------------|------------------------------------------------|
| **Market Leverage Ratio** | `finra_D / market_cap`                 | 衡量整体市场杠杆水平。                         |
| **Money Supply Ratio**    | `finra_D / (m2_money_supply * 1000)`   | 评估保证金债务相对于社会总货币资源的比例。     |
| **Interest Cost Analysis**| `finra_D * (federal_funds_rate / 100)` | 分析杠杆使用者所承担的年度利息成本。           |
| **Leverage Change Rate**  | `(Current - Previous) / Previous`      | 监控保证金债务的月度环比(MoM)和年度同比(YoY)变化率。 |
| **Investor Net Worth**    | `market_cap - finra_D`                 | 评估市场总市值扣除保证金债务后的投资者净资产。 |
| **Vulnerability Index**   | `Z(finra_D) - Z(vix_index)`            | 结合杠杆和波动率的Z-Score，识别高杠杆和低波动率累积的风险。 |
| **VIX vs Leverage**       | `Correlation(vix_index, leverage_ratio)`| 通过相关性和回归分析，研究市场波动率与杠杆水平之间的关系。 |

### 3.2 关键实现细节
- **Z-Score计算**: 采用滚动窗口（`window=252`, `min_periods=63`）计算均值和标准差，以捕捉动态变化。
- **风险阈值**: 为`Market Leverage Ratio`和`Vulnerability Index`设定了明确的风险等级（正常、警告、高风险），用于风险预警。
- **参数设定**: 算法中明确了数据单位的统一（如M2供应量从百万美元转换为千美元）和边界处理规则（如`np.clip`）。

---

## 4. 可视化设计 (Visualization Design)

### 4.1 UI/UX设计思路
可视化设计的核心思路是最大化信息密度和用户体验。通过统一的颜色系统、字体规范和响应式布局，确保在不同设备上均能清晰传达信息。设计强调交互性，如悬停提示、缩放平移和数据筛选，帮助用户进行探索性分析。

### 4.2 图表展示形式
每个核心指标都设计了特定的图表类型以最好地呈现其数据特征：

| 指标                       | 图表类型                          | 关键设计元素                                       |
|----------------------------|-----------------------------------|----------------------------------------------------|
| **Market Leverage Ratio**  | 线形图 + 风险区域                 | 用不同颜色的背景区域（绿、黄、红）标识风险等级。   |
| **Money Supply Ratio**     | 面积图 + 趋势线                   | 突出比率随时间变化的累积效应和长期趋势。         |
| **Interest Cost Analysis** | 组合图 (柱状图+线形图)            | 双Y轴设计，同时展示利息成本（柱状）和利率（折线）。|
| **Leverage Change Rate**   | 双线图 (YoY vs MoM)               | 区分年度和月度变化，使用正负填充区域展示增减。     |
| **Investor Net Worth**     | 阶梯图 + 趋势线                   | 展示净资产的阶段性变化和长期增长趋势。             |
| **Vulnerability Index**    | 线形图 + 风险区域分层             | 用五层颜色区域（从绿到红）精确划分风险等级。       |
| **VIX vs Leverage**        | 双Y轴散点图 + 象限分析            | 在散点图上划分四个象限，分析高/低杠杆与高/低VIX的组合状态。 |

### 4.3 交互逻辑
- **通用交互**: 所有图表均支持悬停提示、缩放平移和数据筛选。
- **特定交互**:
  - **Vulnerability Index**: 允许用户调整风险阈值。
  - **VIX vs Leverage**: 提供回归分析参数调整功能。
